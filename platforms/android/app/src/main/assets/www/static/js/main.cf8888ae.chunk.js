(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,n){e.exports=n.p+"static/media/logo.8ad1a424.svg"},24:function(e,t,n){e.exports=n(59)},35:function(e,t,n){},46:function(e,t,n){},48:function(e,t,n){},50:function(e,t,n){},52:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(18),r=n.n(s),o=n(2),c=n(3),l=n(6),u=n(5),h=n(7),d=n(63),m=n(64),f=n(65),v=n(62),p=n(4),b=n.n(p);window.jQuery=b.a,window.$=b.a;n(29),n(30),n(31),n(32),n(33);var g=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={message:e.message},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.message?i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4 col-md-offset-4"},i.a.createElement("div",{className:this.getCssClass()},i.a.createElement("button",{className:"close",type:"button",onClick:this.handleClose.bind(this)},"\xd7"),i.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.message}})))):null}},{key:"getCssClass",value:function(){return["alert","alert-dismissible",this.getAdditionalCssClass()].join(" ")}},{key:"handleClose",value:function(){this.setState({message:null})}},{key:"componentDidMount",value:function(){var e=this;b()(document).on(this.constructor.getEventName(),function(t,n){e.setState({message:n.message})})}},{key:"componentWillUnmount",value:function(){b()(document).off(this.constructor.getEventName())}},{key:"getAdditionalCssClass",value:function(){}},{key:"getName",value:function(){}}],[{key:"getEventName",value:function(){return"mykonote.flash."+this.prototype.getName()}},{key:"show",value:function(e){b()(document).trigger(this.getEventName(),{message:e})}},{key:"clear",value:function(){b()(document).trigger(this.getEventName(),{message:null})}}]),t}(a.Component),y=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getName",value:function(){return"notice"}},{key:"getAdditionalCssClass",value:function(){return"alert-info"}}]),t}(g),k=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getName",value:function(){return"alert"}},{key:"getAdditionalCssClass",value:function(){return"alert-warning"}}]),t}(g),N=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(y,null),i.a.createElement(k,null))}}]),t}(a.Component),w=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("form",{className:"simple_form new_user",onSubmit:this.handleFormSubmit.bind(this)},i.a.createElement("input",{type:"hidden",value:"\u2713",name:"utf8"}),i.a.createElement("div",{className:"form-inputs"},this.renderEmail(),this.renderPassword(),this.renderRememberMe()),i.a.createElement("div",{className:"form-actions"},this.renderSubmit()))}},{key:"renderEmail",value:function(){return i.a.createElement("div",{className:"form-group email optional user_email is-empty"},i.a.createElement("label",{htmlFor:"user_email",className:"email optional control-label"},"Email"),i.a.createElement("input",{type:"email",id:"user_email",name:"user[email]",autoFocus:"autofocus",className:"string email optional form-control"}))}},{key:"renderPassword",value:function(){return i.a.createElement("div",{className:"form-group password optional user_password is-empty"},i.a.createElement("label",{htmlFor:"user_password",className:"password optional control-label"},"Password"),i.a.createElement("input",{type:"password",id:"user_password",name:"user[password]",className:"password optional form-control"}))}},{key:"renderRememberMe",value:function(){return i.a.createElement("div",{className:"form-group boolean optional user_remember_me"},i.a.createElement("div",{className:"checkbox"},i.a.createElement("label",{htmlFor:"user_remember_me",className:"boolean optional"},i.a.createElement("input",{type:"checkbox",id:"user_remember_me",name:"user[remember_me]",value:"1",className:"boolean optional"}),"Remember me")))}},{key:"renderSubmit",value:function(){return i.a.createElement("input",{type:"submit",className:"btn btn-raised btn-primary btn-info",value:"Log in",name:"commit"})}},{key:"handleFormSubmit",value:function(e){var t=this;e.preventDefault();var n=b()(e.target).serialize();b.a.ajax({url:"/users/sign_in",method:"POST",dataType:"json",data:n}).done(function(e){k.clear(),t.props.onLoginSuccess()}).fail(function(){k.show("Sorry, that did not work. Did you enter a wrong username or a wrong password?")})}}]),t}(a.Component),S=n(23),E=n(19),C=n.n(E),j=n(16),O=n.n(j),x=n(15),_=n.n(x),L=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"subscribe",value:function(e,t){var n=this;this.topics.hasOwnProperty.call(this.topics,e)||(this.topics[e]=[]);var a=this.topics[e].push(t)-1;return{remove:function(){delete n.topics[e][a]}}}},{key:"publish",value:function(e,t){this.topics.hasOwnProperty.call(this.topics,e)&&this.topics[e].forEach(function(e){e(void 0!==t?t:{})})}},{key:"topics",get:function(){return"undefined"===typeof this._topics&&(this._topics={}),this._topics}}]),e}();_.a.prototype.stopCallback=function(){return!1},_.a.bind("alt+shift+f",function(){return L.publish("search.focus"),!1}),_.a.bind("alt+shift+n",function(){return L.publish("note.new"),!1});var I=n(20),A=n.n(I),M=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getMode",value:function(){var e=["xs","sm","md","lg"],t=window.document,n=t.createElement("div");t.body.appendChild(n);for(var a=e.length-1;a>=0;a--){var i=e[a];if(n.className="hidden-"+i,null===n.offsetParent)return t.body.removeChild(n),i}return""}},{key:"isMobileMode",value:function(){var e=this.getMode();return"xs"===e||"sm"===e}}]),e}(),T=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"generateV4",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}]),e}(),P=function(){function e(t,n,a,i,s,r){Object(o.a)(this,e),this._uid=t||T.generateV4(),this._title=n||"",this._content=a||"",this._createdAt=i||new Date,this._updatedAt=s||this._createdAt,this._serverUpdatedAt=this._updatedAt,this._archivedAt=r}return Object(c.a)(e,[{key:"setArchived",value:function(){this._archivedAt=new Date}},{key:"isNew",value:function(){return!this.title&&!this.content}},{key:"toJson",value:function(){return JSON.stringify({uid:this.uid,title:this.title,content:this.content,created_at:this.createdAt.toISOString(),updated_at:this.updatedAt.toISOString(),server_updated_at:this.serverUpdatedAt.toISOString(),archived_at:this.archivedAt?this.archivedAt.toISOString():null})}},{key:"uid",get:function(){return this._uid}},{key:"title",get:function(){return this._title},set:function(e){this._updatedAt=new Date,this._title=e}},{key:"content",get:function(){return this._content},set:function(e){this._updatedAt=new Date,this._content=e}},{key:"createdAt",get:function(){return this._createdAt}},{key:"updatedAt",get:function(){return this._updatedAt}},{key:"serverUpdatedAt",get:function(){return this._serverUpdatedAt},set:function(e){this._serverUpdatedAt=e}},{key:"archivedAt",get:function(){return this._archivedAt}}],[{key:"fromAttributes",value:function(t){return new e(t.uid,t.title,t.content,new Date(t.created_at),new Date(t.updated_at),t.archived_at?new Date(t.archived_at):null)}}]),e}();var B=function(){return i.a.createElement("svg",{className:"spinner",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("circle",{className:"path",fill:"none",strokeWidth:"6",strokeLinecap:"round",cx:"33",cy:"33",r:"30"}))},D=(n(35),function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={notes:[],currentPage:1,hasMorePages:!1,isSynced:!1,searchQuery:void 0},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:this.getListCssClass(),ref:function(t){return e.$list=b()(t)}},this.renderList(),this.renderNextPageLink(),this.renderListSpinner())}},{key:"renderList",value:function(){var e=this;return this.state.notes.map(function(t){return e.renderListItem(t)})}},{key:"renderListItem",value:function(e){return i.a.createElement("div",{key:e.uid},i.a.createElement("div",{className:this.getListItemCssClass(e),onClick:this.handleNoteClick.bind(this,e)},i.a.createElement("div",{className:"row-picture"},this.getNoteAvatar(e)),i.a.createElement("div",{className:"row-content"},this.renderListItemButton("action-secondary action-secondary-before",this.props.handleArchiveNoteClick.bind(this,e),"archive"),this.renderListItemButton("action-secondary",this.props.handleDeleteNoteClick.bind(this,e),"delete"),i.a.createElement("h4",{className:"list-group-item-heading"},e.title),i.a.createElement("div",{className:"list-group-item-text"},A.a.relativeTime(e.updatedAt)))),i.a.createElement("div",{className:"list-group-separator"}))}},{key:"renderListItemButton",value:function(e,t,n){return i.a.createElement("div",{className:e,onClick:t},i.a.createElement("i",{className:"material-icons"},n))}},{key:"renderNextPageLink",value:function(){if(this.state.hasMorePages)return i.a.createElement("div",{className:"list-more list-more-next-page"},i.a.createElement("button",{onClick:this.handleNextPageClick.bind(this),className:"btn btn-info btn-link btn-sm"},i.a.createElement("i",{className:"material-icons list-more-icon"},"expand_more")))}},{key:"renderListSpinner",value:function(){return i.a.createElement("div",{className:"list-more list-more-spinner hidden"},i.a.createElement(B,null))}},{key:"getListItemCssClass",value:function(e){var t="list-group-item note-navigation-item";return e.uid===this.props.activeNoteUid&&(t+=" active"),t}},{key:"getListCssClass",value:function(){var e="list-group notes-list collapse in-sm";return this.props.isInitialEdit||(e+=" in"),e}},{key:"componentDidMount",value:function(){var e=this;this.toggleListMore(!1),M.isMobileMode()&&(this.$list.collapse({toggle:!1}),this.$list.on("hidden.bs.collapse",function(){L.publish("hamburger.hide_end")}),L.subscribe("hamburger.show",function(){e.$list.collapse("show")}),L.subscribe("hamburger.hide",function(){e.$list.collapse("hide")}),L.subscribe("search.entered",function(){e.$list.collapse("show")}),L.subscribe("note.open",function(){e.$list.collapse("hide")}))}},{key:"componentDidUpdate",value:function(){this.listNeedsUpdate&&(this.listNeedsUpdate=!1,this.updateList())}},{key:"componentWillReceiveProps",value:function(e){!this.state.isSynced&&e.isSynced&&(this.listNeedsUpdate=!0),this.state.searchQuery!==e.searchQuery&&(this.listNeedsUpdate=!0,this.setSearchProgress(!0)),this.setState({isSynced:e.isSynced,searchQuery:e.searchQuery})}},{key:"handleNoteClick",value:function(e,t){b()(".note-navigation-item").removeClass("active"),b()(t.currentTarget).addClass("active"),M.isMobileMode()&&L.publish("hamburger.hide"),L.publish("note.open"),this.props.handleNoteClick(e,t)}},{key:"handleNextPageClick",value:function(e){var t=this;e.preventDefault(),b()(e.currentTarget).blur(),this.toggleListMore(!1),this.setState({currentPage:this.state.currentPage+1},function(){t.updateList()})}},{key:"updateList",value:function(){this.updateListRequest&&this.updateListRequest.abort(),this.updateListRequest=b.a.ajax({url:"/api/notes",dataType:"json",data:{search:this.state.searchQuery,page:this.state.currentPage}}),this.executeUpdateListRequest()}},{key:"executeUpdateListRequest",value:function(){var e=this;this.updateListRequest.done(function(t){e.toggleListMore(!0);var n=t.notes.map(function(e){return P.fromAttributes(e)});e.setState({notes:n,currentPage:t.current_page,hasMorePages:t.has_more_pages})}).fail(function(t,n,a){"abort"!==a&&(e.toggleListMore(!0),k.show("Watch out, the list is not up to date."),console.error("url: ",e.props.url,"status: ",n,"error: ",a.toString()))}).always(function(){e.setSearchProgress(!1)})}},{key:"getPreviewImageUrl",value:function(e){var t=e.content.match(/<img.*? src=['"]([^'"]+)['"].*?>/);return t?t[1]:null}},{key:"getNoteAvatar",value:function(e){var t=this.getPreviewImageUrl(e);return t?i.a.createElement("img",{src:t,className:"circle",alt:"note thumbnail"}):i.a.createElement("i",{className:"material-icons"},"subject")}},{key:"toggleListMore",value:function(e){e?(b()(".list-more-next-page").removeClass("hidden"),b()(".list-more-spinner").addClass("hidden")):(b()(".list-more-next-page").addClass("hidden"),b()(".list-more-spinner").removeClass("hidden"))}},{key:"setSearchProgress",value:function(e){L.publish("spinner.toggle",{show:e})}}]),t}(a.Component)),$=n(21),U=n.n($);n(37);window.hljs=U.a;var R=n(11),F=n.n(R),W=(n(60),n(44),n(46),function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={note:a.props.note},a.shouldRerender=!0,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("form",{className:"form-horizontal",ref:function(t){return e.formContainerElement=t},onSubmit:this.handleFormSubmit},i.a.createElement("div",{className:"form-inputs"},this.renderTitle(),this.renderContent())))}},{key:"renderTitle",value:function(){var e=this;return i.a.createElement("div",{className:"form-group form-group-no-label string optional"},i.a.createElement("input",{type:"text",className:"string optional form-control",value:this.state.note.title,onChange:this.handleTitleChange.bind(this),placeholder:"Title",ref:function(t){return e.titleElement=t}}))}},{key:"renderContent",value:function(){var e=this;return i.a.createElement("div",{className:"form-group form-group-no-label text optional"},i.a.createElement("div",{ref:function(t){return e.contentContainerElement=t}}))}},{key:"handleFormSubmit",value:function(e){return e.preventDefault(),!1}},{key:"handleTitleChange",value:function(){this.shouldRerender=!0;var e=this.state.note;e.title=this.titleElement.value,this.setState({note:e},this.handleChange)}},{key:"handleContentChange",value:function(){this.shouldRerender=!1;var e=this.state.note;e.content=this.contentElement.innerHTML,this.setState({note:e},this.handleChange)}},{key:"handleChange",value:function(){this.props.handleChange(this.state.note)}},{key:"componentDidMount",value:function(){var e=this;this.focusTitleFieldIfNewNote(),this.renderEditor(),L.subscribe("note.update",function(t){e.titleElement.value=t.title,e.handleTitleChange(),e.editor.pasteHTML(t.content)}),M.isMobileMode()&&(L.subscribe("hamburger.show",function(){e.formContainerElement.classList.add("hidden")}),L.subscribe("hamburger.hide",function(){e.formContainerElement.classList.remove("hidden")}),L.subscribe("search.entered",function(){e.formContainerElement.classList.add("hidden")}))}},{key:"componentDidUpdate",value:function(){this.editor.off("text-change"),this.editor.setText(""),this.contentElement.innerHTML=this.state.note.content,this.editor.history.clear(),this.editor.update(),this.editor.on("text-change",this.handleContentChange.bind(this))}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.note.uid!==this.state.note.uid&&(this.shouldRerender=!0,this.setState({note:e.note},function(){return t.focusTitleFieldIfNewNote()}))}},{key:"shouldComponentUpdate",value:function(e,t){return this.shouldRerender}},{key:"renderEditor",value:function(){this.editor=new F.a(this.contentContainerElement,{theme:"snow",modules:{syntax:!0,toolbar:[[{header:[1,2,!1]}],["bold","italic","strike"],[{color:[]},{background:[]}],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"},"task-list",{indent:"-1"},{indent:"+1"}],["link","image"],["clean"]],"task-list":!0}}),this.contentElement=this.contentContainerElement.querySelector(".ql-editor")}},{key:"focusTitleFieldIfNewNote",value:function(){this.state.note.isNew()&&this.titleElement.focus()}}]),t}(a.Component)),H=function(){function e(t){Object(o.a)(this,e),this.history=t}return Object(c.a)(e,[{key:"setNew",value:function(){this.history.push("/notes")}},{key:"setEdit",value:function(e){var t="/notes/".concat(e.uid);this.history.location.pathname!==t&&this.history.push(t)}},{key:"setBrowserTitle",value:function(e){e&&e.title?document.title="".concat(e.title," | Mykonote"):document.title="Mykonote"}}]),e}(),Q=n(22),K=n.n(Q),q=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={showSpinner:!1},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4"},i.a.createElement("div",{className:"navbar-header"},this.renderLogo(),this.renderMobileHamburgerMenu(),this.renderMobileSearchButton()),this.renderSearchBox()))}},{key:"renderLogo",value:function(){return i.a.createElement("div",{className:"navbar-brand"},i.a.createElement("div",{className:"navbar-spinner"},this.state.showSpinner?i.a.createElement(B,null):i.a.createElement("div",{className:"navbar-logo"},i.a.createElement("img",{src:K.a,alt:"logo"}))))}},{key:"componentDidMount",value:function(){this.subscribeSpinner(),this.subscribeSearch(),this.subscribeMobileSearch()}},{key:"componentWillUnmount",value:function(){this.$searchBox.off("shown.bs.collapse")}},{key:"renderSearchBox",value:function(){var e=this;return i.a.createElement("div",{className:"navbar-form navbar-right search-bar collapse in-sm",ref:function(t){return e.$searchBox=b()(t)}},i.a.createElement("input",{type:"text",className:"string optional form-control search-input",placeholder:"Search",onChange:this.props.handleSearchEnter,ref:function(t){return e.$searchInput=b()(t)}}),i.a.createElement("button",{type:"button",className:"close clear-search",onClick:this.handleSearchCleared.bind(this)},"\xd7"))}},{key:"renderMobileHamburgerMenu",value:function(){return i.a.createElement("button",{className:"navbar-toggle navbar-hamburger-button",type:"button",onClick:this.handleHamburgerButtonClick},i.a.createElement("span",{className:"icon-bar"}),i.a.createElement("span",{className:"icon-bar"}),i.a.createElement("span",{className:"icon-bar"}))}},{key:"renderMobileSearchButton",value:function(){var e=this;return i.a.createElement("button",{className:"navbar-toggle navbar-search-button",type:"button",onClick:this.handleSearchButtonClick.bind(this),ref:function(t){return e.$searchButton=b()(t)}},i.a.createElement("i",{className:"material-icons"},"search"))}},{key:"getSpinnerCssClass",value:function(){var e="spinner";return this.state.showSpinner||(e+=" hidden"),e}},{key:"getLogoCssClass",value:function(){var e="navbar-logo";return this.state.showSpinner&&(e+=" hidden"),e}},{key:"handleSearchButtonClick",value:function(){M.isMobileMode()&&(this.$searchButton.hasClass("is-expanded")?(this.$searchButton.removeClass("is-expanded"),L.publish("search.hide")):(this.$searchButton.addClass("is-expanded"),L.publish("search.show")))}},{key:"handleHamburgerButtonClick",value:function(e){if(M.isMobileMode()){var t=b()(e.target);t.hasClass("is-expanded")?(t.removeClass("is-expanded"),L.publish("hamburger.hide")):(t.addClass("is-expanded"),L.publish("hamburger.show"))}}},{key:"handleSearchCleared",value:function(e){this.$searchInput.val(""),b()(e.target).blur(),this.props.handleSearchCleared()}},{key:"subscribeSpinner",value:function(){var e=this;L.subscribe("spinner.toggle",function(t){e.setState({showSpinner:t.show})})}},{key:"subscribeSearch",value:function(){var e=this;L.subscribe("search.focus",function(){e.$searchInput.focus(),e.$searchInput.select()})}},{key:"subscribeMobileSearch",value:function(){var e=this;M.isMobileMode()&&(L.subscribe("search.hide",function(){e.$searchButton.removeClass("is-expanded")}),this.$searchBox.collapse({toggle:!1}),this.$searchBox.on("hidden.bs.collapse",function(){L.publish("search.hide_end")}),L.subscribe("search.show",function(){e.$searchBox.collapse("show")}),L.subscribe("search.hide",function(){e.$searchBox.collapse("hide")}),L.subscribe("note.open",function(){""===e.$searchInput.val()&&L.publish("search.hide")}),this.$searchBox.on("shown.bs.collapse",function(){e.$searchInput.focus()}))}}]),t}(a.Component),Y=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={isSynced:e.isSynced},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({isSynced:e.isSynced})}},{key:"render",value:function(){return i.a.createElement("div",{className:"save-state"},this.state.isSynced?i.a.createElement("div",{className:"label label-success"},"Saved"):i.a.createElement("div",{className:"label label-warning"},"Saving"))}}]),t}(a.Component),J=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("button",{className:"btn btn-info btn-fab btn-new-note",onClick:this.handleNewNoteClick.bind(this)},i.a.createElement("i",{className:"material-icons"},"add"))}},{key:"handleNewNoteClick",value:function(e){e.preventDefault(),M.isMobileMode()&&L.publish("hamburger.hide"),this.props.handleNewNoteClick()}}]),t}(a.Component),V=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"set",value:function(t){localStorage.setItem(e._getKey(t),t.toJson())}},{key:"get",value:function(t){return localStorage.getItem(e._getKey(t))}},{key:"eachNote",value:function(t){var n=e._getLocalStorageKeys(),a=!0,i=!1,s=void 0;try{for(var r,o=n[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var c=r.value,l=localStorage.getItem(c);t(JSON.parse(l),l)}}catch(u){i=!0,s=u}finally{try{a||null==o.return||o.return()}finally{if(i)throw s}}}},{key:"remove",value:function(t){localStorage.removeItem(e._getKey(t))}},{key:"isEmpty",value:function(){return 0===e._getLocalStorageKeys().length}},{key:"_getLocalStorageKeys",value:function(){for(var t=[],n=localStorage.length,a=0;a<n;++a){var i=localStorage.key(a);i.startsWith(e.KEY_PREFIX)&&t.push(i)}return t}},{key:"_getKey",value:function(t){return e.KEY_PREFIX+t.uid}},{key:"KEY_PREFIX",get:function(){return"note-"}}]),e}(),z=function(){function e(t){Object(o.a)(this,e),this.onServerSyncCallback=t,this.setSyncStatus()}return Object(c.a)(e,[{key:"startPolling",value:function(){setInterval(this.syncToServer.bind(this),e.POLLING_INTERVAL)}},{key:"setChange",value:function(e){this.setSyncStatus(!1),V.set(e)}},{key:"syncToServer",value:function(){var e=this;b.a.active||V.eachNote(function(t,n){var a="/api/notes/"+t.uid;b.a.ajax({url:a,method:"PUT",dataType:"json",data:{note:t}}).done(function(a){return e.ajaxDone(t,n,P.fromAttributes(a))}).fail(function(t,n,i){return e.ajaxFail(t,n,i,a)})})}},{key:"setSyncStatus",value:function(e,t){void 0===e&&(e=V.isEmpty()),window.onbeforeunload=e?void 0:function(){return"Behold! You have unsynchronized changes. If you leave the page now, your changes won't be saved to the server.\n(Your data won't be lost, but it will only remain locally in your browser)"},this.onServerSyncCallback({isSynced:e,note:t})}},{key:"ajaxDone",value:function(e,t,n){var a=V.get(e);if(t===a)V.remove(e);else{var i=P.fromAttributes(JSON.parse(a));i.serverUpdatedAt=n.serverUpdatedAt,V.set(i)}this.setSyncStatus(void 0,n)}},{key:"ajaxFail",value:function(e,t,n,a){0!==e.readyState&&(401===e.status?k.show('Your session has expired. You need to <a href="/" class="alert-link">sign in</a> again.<br>Your changes won\'t be lost, once you\'re signed in they will be saved to the server.'):(k.show("Something went sideways: "+n.toString()),console.error("url: ",a,"xhr: ",e,"status: ",t,"err: ",n.toString())))}}],[{key:"POLLING_INTERVAL",get:function(){return 3e3}}]),e}(),G=function(e){function t(e,n){var a;Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).pushState=new H(a.props.history);var i=a.props.match;return e.note?a.initStateFromNote(e.note):i.params.id?a.initStateFromNoteId(i.params.id):a.state=a.getNewNoteAttributes(),a.handleSearchEnterDebounced=C()(500,a.handleSearchEnterDebounced),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,this.renderHeaderBar(),this.renderContent())}},{key:"componentDidMount",value:function(){var e=this;this.autoSave=new z(this.handleServerSync.bind(this)),this.autoSave.startPolling(),L.subscribe("note.create",function(t){e.setNewNote(function(){L.publish("hamburger.hide"),L.publish("note.update",t)})}),L.subscribe("note.new",function(t){e.setNewNote()})}},{key:"renderHeaderBar",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"navbar navbar-fixed-top navbar-info navbar-notes"},i.a.createElement(q,{handleSearchEnter:this.handleSearchEnter.bind(this),handleSearchCleared:this.handleSearchCleared.bind(this)}),i.a.createElement(Y,{isSynced:this.state.isSynced}))))}},{key:"renderContent",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4"},i.a.createElement(D,{activeNoteUid:this.state.note.uid,isSynced:this.state.isSynced,isInitialEdit:this.state.isInitialEdit,searchQuery:this.state.searchQuery,handleNoteClick:this.handleNoteClick.bind(this),handleDeleteNoteClick:this.handleDeleteNoteClick.bind(this),handleArchiveNoteClick:this.handleArchiveNoteClick.bind(this)})),i.a.createElement("div",{className:"col-md-8"},i.a.createElement(W,{note:this.state.note,handleChange:this.handleEditChange.bind(this)})),i.a.createElement(J,{handleNewNoteClick:this.handleNewNoteClick.bind(this)}))}},{key:"initStateFromNote",value:function(e){this.state={isInitialEdit:!0,note:P.fromAttributes(e)},this.pushState.setBrowserTitle(e)}},{key:"initStateFromNoteId",value:function(e){var t=this;this.state=Object(S.a)({},this.getNewNoteAttributes(),{isInitialEdit:!0}),b.a.ajax({url:"/api/notes/".concat(e),dataType:"json"}).done(function(e){var n=P.fromAttributes(e.note);t.setState({isInitialEdit:!0,note:n},function(){return t.pushState.setBrowserTitle(n)})}).fail(function(e,t,n){k.show("While trying to load the note the internet broke down (or something else failed, maybe the note could not be found)")})}},{key:"handleNoteClick",value:function(e,t){t.preventDefault(),this.setState({note:e}),this.pushState.setEdit(e),this.pushState.setBrowserTitle(e)}},{key:"handleDeleteNoteClick",value:function(e,t){var n=this;t.preventDefault(),t.stopPropagation(),O.a.confirm("Are you sure? <br> The note will be permanently deleted.",function(t){t&&(n.setState({isSynced:!1}),n.deleteNote(e))})}},{key:"handleArchiveNoteClick",value:function(e,t){var n=this;t.preventDefault(),t.stopPropagation(),O.a.confirm("Are you sure you want to archive this note?",function(t){t&&(e.setArchived(),n.handleEditChange(e),n.setNewNote())})}},{key:"handleNewNoteClick",value:function(){this.setNewNote()}},{key:"handleEditChange",value:function(e){this.pushState.setEdit(e),this.autoSave.setChange(e)}},{key:"handleServerSync",value:function(e){var t={isSynced:e.isSynced};e.note&&this.state.note.uid===e.note.uid&&(t.note=this.state.note,t.note.serverUpdatedAt=e.note.serverUpdatedAt),this.setState(t),e.isSynced&&this.pushState.setBrowserTitle(this.state.note)}},{key:"handleSearchEnter",value:function(e){e.persist(),this.handleSearchEnterDebounced(e)}},{key:"handleSearchEnterDebounced",value:function(e){this.setState({searchQuery:e.target.value}),L.publish("search.entered")}},{key:"handleSearchCleared",value:function(){this.setState({searchQuery:""}),L.publish("search.entered")}},{key:"getNewNoteAttributes",value:function(){return{note:new P}}},{key:"setNewNote",value:function(e){this.setState(this.getNewNoteAttributes(),e),this.pushState.setNew(),this.pushState.setBrowserTitle()}},{key:"deleteNote",value:function(e){var t=this;b.a.ajax({url:"/api/notes/"+e.uid,method:"DELETE",dataType:"json"}).done(function(){localStorage.removeItem("note-"+e.uid),t.state.note.uid===e.uid&&t.setNewNote()}).fail(function(t,n,a){var i="Oh my, the note could not be deleted.";0===t.readyState&&(i+="<br>Please check your internet connection (Well yes, sorry, deleting in offline mode is not yet suppported)."),k.show(i),console.error("note.uid: ",e.uid,"status: ",n,"error: ",a.toString())}).always(function(){t.setState({isSynced:!0})})}}]),t}(a.Component),X=(n(48),n(50),n(52),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isLoggedIn:null},n.setIsLoggedIn(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(d.a,null,i.a.createElement("div",{className:"container-fluid"},i.a.createElement(N,null),this.renderLoggedIn(),this.renderLoggedOut()))}},{key:"componentDidMount",value:function(){b.a.material.init()}},{key:"onLoginSuccess",value:function(){this.setState({isLoggedIn:!0})}},{key:"setIsLoggedIn",value:function(){var e=this;b.a.ajax({url:"/users/is_authenticated",method:"GET",dataType:"json"}).done(function(t,n,a){e.onLoginSuccess()}).fail(function(){e.setState({isLoggedIn:!1})})}},{key:"renderLoggedIn",value:function(){if(!0===this.state.isLoggedIn)return i.a.createElement(m.a,null,i.a.createElement(f.a,{path:"/notes/:id",component:G}),i.a.createElement(f.a,{path:"/notes",component:G}),i.a.createElement(v.a,{from:"/",to:"/notes"}))}},{key:"renderLoggedOut",value:function(){if(!1===this.state.isLoggedIn)return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6 col-md-offset-3"},i.a.createElement("div",{className:"well"},i.a.createElement(w,{onLoginSuccess:this.onLoginSuccess.bind(this)}))))}}]),t}(a.Component)),Z=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ee(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}window.EventHive=L,window.NoticeFlash=y,window.AlertFlash=k,window.API_HOST&&b.a.ajaxPrefilter(function(e){e.url=window.API_HOST+e.url}),r.a.render(i.a.createElement(X,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat(".","/service-worker.js");Z?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ee(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ee(e)})}}()}},[[24,2,1]]]);
//# sourceMappingURL=main.cf8888ae.chunk.js.map