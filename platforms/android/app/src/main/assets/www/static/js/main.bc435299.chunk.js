(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(e,t,n){e.exports=n.p+"static/media/logo.8ad1a424.svg"},26:function(e,t,n){e.exports=n(61)},42:function(e,t,n){},53:function(e,t,n){},55:function(e,t,n){},57:function(e,t,n){},59:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(19),s=n.n(r),o=n(2),c=n(3),l=n(6),u=n(5),h=n(7),d=n(65),m=n(66),f=n(67),v=n(64),p=n(4),b=n.n(p);window.jQuery=b.a,window.$=b.a;n(31),n(32),n(33),n(34),n(35);var g=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={message:e.message},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.message?i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4 col-md-offset-4"},i.a.createElement("div",{className:this.getCssClass()},i.a.createElement("button",{className:"close",type:"button",onClick:this.handleClose.bind(this)},"\xd7"),i.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.message}})))):null}},{key:"getCssClass",value:function(){return["alert","alert-dismissible",this.getAdditionalCssClass()].join(" ")}},{key:"handleClose",value:function(){this.setState({message:null})}},{key:"componentDidMount",value:function(){var e=this;b()(document).on(this.constructor.getEventName(),function(t,n){e.setState({message:n.message})})}},{key:"componentWillUnmount",value:function(){b()(document).off(this.constructor.getEventName())}},{key:"getAdditionalCssClass",value:function(){}},{key:"getName",value:function(){}}],[{key:"getEventName",value:function(){return"mykonote.flash."+this.prototype.getName()}},{key:"show",value:function(e){b()(document).trigger(this.getEventName(),{message:e})}},{key:"clear",value:function(){b()(document).trigger(this.getEventName(),{message:null})}}]),t}(a.Component),y=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getName",value:function(){return"notice"}},{key:"getAdditionalCssClass",value:function(){return"alert-info"}}]),t}(g),k=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getName",value:function(){return"alert"}},{key:"getAdditionalCssClass",value:function(){return"alert-warning"}}]),t}(g),E=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(y,null),i.a.createElement(k,null))}}]),t}(a.Component),w=n(13);function S(e){return i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:O(e),className:"control-label"},e.label),i.a.createElement("input",{type:e.type,id:O(e),name:x(e),className:"string form-control",onChange:function(t){return e.onChange(x(e),t.target.value)}}))}function N(e){return i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"checkbox"},i.a.createElement("label",{htmlFor:O(e)},i.a.createElement("input",{type:"checkbox",id:O(e),name:x(e),onChange:function(t){return e.onChange(x(e),t.target.checked)}}),e.label)))}function C(e){return i.a.createElement("input",{type:"submit",className:"btn btn-raised btn-primary btn-info",value:e.label})}function j(){return i.a.createElement("input",{type:"hidden",value:"\u2713",name:"utf8"})}function O(e){return"".concat(e.model,"_").concat(e.attribute)}function x(e){return"".concat(e.model,"[").concat(e.attribute,"]")}function L(){b()("html, body").animate({scrollTop:0},300)}var I=n(63);function _(){return i.a.createElement("div",null,i.a.createElement(f.a,{path:"/login",render:function(e){return i.a.createElement(I.a,{className:"btn btn-info btn-link btn-no-padding",to:"/register"},"Register")}}),i.a.createElement(f.a,{path:"/register",render:function(e){return i.a.createElement(I.a,{className:"btn btn-info btn-link btn-no-padding",to:"/login"},"Login")}}))}function A(e){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6 col-md-offset-3"},e.intro?i.a.createElement("div",{className:"jumbotron"},e.intro):null,i.a.createElement("div",{className:"well"},e.children,i.a.createElement(_,null))))}var T=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(A,null,i.a.createElement("form",{onSubmit:this.handleFormSubmit.bind(this)},i.a.createElement(j,null),i.a.createElement("div",{className:"form-inputs"},this.renderTextInput("email","email","Email"),this.renderTextInput("password","password","Password"),i.a.createElement(N,{model:"user",attribute:"remember_me",label:"Remember me",onChange:this.setValue.bind(this)})),i.a.createElement("div",{className:"form-actions"},i.a.createElement(C,{label:"Log in"}))))}},{key:"renderTextInput",value:function(e,t,n){return i.a.createElement(S,{type:e,model:"user",attribute:t,label:n,onChange:this.setValue.bind(this)})}},{key:"setValue",value:function(e,t){this.setState(Object(w.a)({},e,t))}},{key:"handleFormSubmit",value:function(e){var t=this;e.preventDefault(),b.a.ajax({url:"/users/sign_in",method:"POST",dataType:"json",data:this.state}).done(function(e){k.clear(),t.props.onLoginSuccess()}).fail(function(){k.show("Sorry, that did not work. Did you enter a wrong username or a wrong password?")}).always(L)}}]),t}(a.Component),M=n(20),P=n(21),B=n.n(P),D=n(17),$=n.n(D),U=n(16),R=n.n(U),F=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"subscribe",value:function(e,t){var n=this;this.topics.hasOwnProperty.call(this.topics,e)||(this.topics[e]=[]);var a=this.topics[e].push(t)-1;return{remove:function(){delete n.topics[e][a]}}}},{key:"publish",value:function(e,t){this.topics.hasOwnProperty.call(this.topics,e)&&this.topics[e].forEach(function(e){e(void 0!==t?t:{})})}},{key:"topics",get:function(){return"undefined"===typeof this._topics&&(this._topics={}),this._topics}}]),e}();R.a.prototype.stopCallback=function(){return!1},R.a.bind("alt+shift+f",function(){return F.publish("search.focus"),!1}),R.a.bind("alt+shift+n",function(){return F.publish("note.new"),!1});var W=n(22),H=n.n(W),Q=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getMode",value:function(){var e=["xs","sm","md","lg"],t=window.document,n=t.createElement("div");t.body.appendChild(n);for(var a=e.length-1;a>=0;a--){var i=e[a];if(n.className="hidden-"+i,null===n.offsetParent)return t.body.removeChild(n),i}return""}},{key:"isMobileMode",value:function(){var e=this.getMode();return"xs"===e||"sm"===e}}]),e}(),Y=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"generateV4",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}]),e}(),K=function(){function e(t,n,a,i,r,s){Object(o.a)(this,e),this._uid=t||Y.generateV4(),this._title=n||"",this._content=a||"",this._createdAt=i||new Date,this._updatedAt=r||this._createdAt,this._serverUpdatedAt=this._updatedAt,this._archivedAt=s}return Object(c.a)(e,[{key:"setArchived",value:function(){this._archivedAt=new Date}},{key:"isNew",value:function(){return!this.title&&!this.content}},{key:"toJson",value:function(){return JSON.stringify({uid:this.uid,title:this.title,content:this.content,created_at:this.createdAt.toISOString(),updated_at:this.updatedAt.toISOString(),server_updated_at:this.serverUpdatedAt.toISOString(),archived_at:this.archivedAt?this.archivedAt.toISOString():null})}},{key:"uid",get:function(){return this._uid}},{key:"title",get:function(){return this._title},set:function(e){this._updatedAt=new Date,this._title=e}},{key:"content",get:function(){return this._content},set:function(e){this._updatedAt=new Date,this._content=e}},{key:"createdAt",get:function(){return this._createdAt}},{key:"updatedAt",get:function(){return this._updatedAt}},{key:"serverUpdatedAt",get:function(){return this._serverUpdatedAt},set:function(e){this._serverUpdatedAt=e}},{key:"archivedAt",get:function(){return this._archivedAt}}],[{key:"fromAttributes",value:function(t){return new e(t.uid,t.title,t.content,new Date(t.created_at),new Date(t.updated_at),t.archived_at?new Date(t.archived_at):null)}}]),e}();var q=function(){return i.a.createElement("svg",{className:"spinner",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("circle",{className:"path",fill:"none",strokeWidth:"6",strokeLinecap:"round",cx:"33",cy:"33",r:"30"}))},J=(n(42),function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={notes:[],currentPage:1,hasMorePages:!1,isSynced:!1,searchQuery:void 0},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:this.getListCssClass(),ref:function(t){return e.$list=b()(t)}},this.renderList(),this.renderNextPageLink(),this.renderListSpinner())}},{key:"renderList",value:function(){var e=this;return this.state.notes.map(function(t){return e.renderListItem(t)})}},{key:"renderListItem",value:function(e){return i.a.createElement("div",{key:e.uid},i.a.createElement("div",{className:this.getListItemCssClass(e),onClick:this.handleNoteClick.bind(this,e)},i.a.createElement("div",{className:"row-picture"},this.getNoteAvatar(e)),i.a.createElement("div",{className:"row-content"},this.renderListItemButton("action-secondary action-secondary-before",this.props.handleArchiveNoteClick.bind(this,e),"archive"),this.renderListItemButton("action-secondary",this.props.handleDeleteNoteClick.bind(this,e),"delete"),i.a.createElement("h4",{className:"list-group-item-heading"},e.title),i.a.createElement("div",{className:"list-group-item-text"},H.a.relativeTime(e.updatedAt)))),i.a.createElement("div",{className:"list-group-separator"}))}},{key:"renderListItemButton",value:function(e,t,n){return i.a.createElement("div",{className:e,onClick:t},i.a.createElement("i",{className:"material-icons"},n))}},{key:"renderNextPageLink",value:function(){if(this.state.hasMorePages)return i.a.createElement("div",{className:"list-more list-more-next-page"},i.a.createElement("button",{onClick:this.handleNextPageClick.bind(this),className:"btn btn-info btn-link btn-sm"},i.a.createElement("i",{className:"material-icons list-more-icon"},"expand_more")))}},{key:"renderListSpinner",value:function(){return i.a.createElement("div",{className:"list-more list-more-spinner hidden"},i.a.createElement(q,null))}},{key:"getListItemCssClass",value:function(e){var t="list-group-item note-navigation-item";return e.uid===this.props.activeNoteUid&&(t+=" active"),t}},{key:"getListCssClass",value:function(){var e="list-group notes-list collapse in-sm";return this.props.isInitialEdit||(e+=" in"),e}},{key:"componentDidMount",value:function(){var e=this;this.toggleListMore(!1),Q.isMobileMode()&&(this.$list.collapse({toggle:!1}),this.$list.on("hidden.bs.collapse",function(){F.publish("hamburger.hide_end")}),F.subscribe("hamburger.show",function(){e.$list.collapse("show")}),F.subscribe("hamburger.hide",function(){e.$list.collapse("hide")}),F.subscribe("search.entered",function(){e.$list.collapse("show")}),F.subscribe("note.open",function(){e.$list.collapse("hide")}))}},{key:"componentDidUpdate",value:function(){this.listNeedsUpdate&&(this.listNeedsUpdate=!1,this.updateList())}},{key:"componentWillReceiveProps",value:function(e){!this.state.isSynced&&e.isSynced&&(this.listNeedsUpdate=!0),this.state.searchQuery!==e.searchQuery&&(this.listNeedsUpdate=!0,this.setSearchProgress(!0)),this.setState({isSynced:e.isSynced,searchQuery:e.searchQuery})}},{key:"handleNoteClick",value:function(e,t){b()(".note-navigation-item").removeClass("active"),b()(t.currentTarget).addClass("active"),Q.isMobileMode()&&F.publish("hamburger.hide"),F.publish("note.open"),this.props.handleNoteClick(e,t)}},{key:"handleNextPageClick",value:function(e){var t=this;e.preventDefault(),b()(e.currentTarget).blur(),this.toggleListMore(!1),this.setState({currentPage:this.state.currentPage+1},function(){t.updateList()})}},{key:"updateList",value:function(){this.updateListRequest&&this.updateListRequest.abort(),this.updateListRequest=b.a.ajax({url:"/api/notes",dataType:"json",data:{search:this.state.searchQuery,page:this.state.currentPage}}),this.executeUpdateListRequest()}},{key:"executeUpdateListRequest",value:function(){var e=this;this.updateListRequest.done(function(t){e.toggleListMore(!0);var n=t.notes.map(function(e){return K.fromAttributes(e)});e.setState({notes:n,currentPage:t.current_page,hasMorePages:t.has_more_pages})}).fail(function(t,n,a){"abort"!==a&&(e.toggleListMore(!0),k.show("Watch out, the list is not up to date."),console.error("url: ",e.props.url,"status: ",n,"error: ",a.toString()))}).always(function(){e.setSearchProgress(!1)})}},{key:"getPreviewImageUrl",value:function(e){var t=e.content.match(/<img.*? src=['"]([^'"]+)['"].*?>/);return t?t[1]:null}},{key:"getNoteAvatar",value:function(e){var t=this.getPreviewImageUrl(e);return t?i.a.createElement("img",{src:t,className:"circle",alt:"note thumbnail"}):i.a.createElement("i",{className:"material-icons"},"subject")}},{key:"toggleListMore",value:function(e){e?(b()(".list-more-next-page").removeClass("hidden"),b()(".list-more-spinner").addClass("hidden")):(b()(".list-more-next-page").addClass("hidden"),b()(".list-more-spinner").removeClass("hidden"))}},{key:"setSearchProgress",value:function(e){F.publish("spinner.toggle",{show:e})}}]),t}(a.Component)),V=n(23),G=n.n(V);n(44);window.hljs=G.a;var X=n(11),z=n.n(X),Z=(n(62),n(51),n(53),function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={note:a.props.note},a.shouldRerender=!0,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("form",{className:"form-horizontal",ref:function(t){return e.formContainerElement=t},onSubmit:this.handleFormSubmit},i.a.createElement("div",{className:"form-inputs"},this.renderTitle(),this.renderContent())))}},{key:"renderTitle",value:function(){var e=this;return i.a.createElement("div",{className:"form-group form-group-no-label string optional"},i.a.createElement("input",{type:"text",className:"string optional form-control",value:this.state.note.title,onChange:this.handleTitleChange.bind(this),placeholder:"Title",ref:function(t){return e.titleElement=t}}))}},{key:"renderContent",value:function(){var e=this;return i.a.createElement("div",{className:"form-group form-group-no-label text optional"},i.a.createElement("div",{ref:function(t){return e.contentContainerElement=t}}))}},{key:"handleFormSubmit",value:function(e){return e.preventDefault(),!1}},{key:"handleTitleChange",value:function(){this.shouldRerender=!0;var e=this.state.note;e.title=this.titleElement.value,this.setState({note:e},this.handleChange)}},{key:"handleContentChange",value:function(){this.shouldRerender=!1;var e=this.state.note;e.content=this.contentElement.innerHTML,this.setState({note:e},this.handleChange)}},{key:"handleChange",value:function(){this.props.handleChange(this.state.note)}},{key:"componentDidMount",value:function(){var e=this;this.focusTitleFieldIfNewNote(),this.renderEditor(),F.subscribe("note.update",function(t){e.titleElement.value=t.title,e.handleTitleChange(),e.editor.pasteHTML(t.content)}),Q.isMobileMode()&&(F.subscribe("hamburger.show",function(){e.formContainerElement.classList.add("hidden")}),F.subscribe("hamburger.hide",function(){e.formContainerElement.classList.remove("hidden")}),F.subscribe("search.entered",function(){e.formContainerElement.classList.add("hidden")}))}},{key:"componentDidUpdate",value:function(){this.editor.off("text-change"),this.editor.setText(""),this.contentElement.innerHTML=this.state.note.content,this.editor.history.clear(),this.editor.update(),this.editor.on("text-change",this.handleContentChange.bind(this))}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.note.uid!==this.state.note.uid&&(this.shouldRerender=!0,this.setState({note:e.note},function(){return t.focusTitleFieldIfNewNote()}))}},{key:"shouldComponentUpdate",value:function(e,t){return this.shouldRerender}},{key:"renderEditor",value:function(){this.editor=new z.a(this.contentContainerElement,{theme:"snow",modules:{syntax:!0,toolbar:[[{header:[1,2,!1]}],["bold","italic","strike"],[{color:[]},{background:[]}],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"},"task-list",{indent:"-1"},{indent:"+1"}],["link","image"],["clean"]],"task-list":!0}}),this.contentElement=this.contentContainerElement.querySelector(".ql-editor")}},{key:"focusTitleFieldIfNewNote",value:function(){this.state.note.isNew()&&this.titleElement.focus()}}]),t}(a.Component)),ee=function(){function e(t){Object(o.a)(this,e),this.history=t}return Object(c.a)(e,[{key:"setNew",value:function(){this.history.push("/notes")}},{key:"setEdit",value:function(e){var t="/notes/".concat(e.uid);this.history.location.pathname!==t&&this.history.push(t)}},{key:"setBrowserTitle",value:function(e){e&&e.title?document.title="".concat(e.title," | Mykonote"):document.title="Mykonote"}}]),e}(),te=n(24),ne=n.n(te),ae=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={showSpinner:!1},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4"},i.a.createElement("div",{className:"navbar-header"},this.renderLogo(),this.renderMobileHamburgerMenu(),this.renderMobileSearchButton()),this.renderSearchBox()))}},{key:"renderLogo",value:function(){return i.a.createElement("div",{className:"navbar-brand"},i.a.createElement("div",{className:"navbar-spinner"},this.state.showSpinner?i.a.createElement(q,null):i.a.createElement("div",{className:"navbar-logo"},i.a.createElement("img",{src:ne.a,alt:"logo"}))))}},{key:"componentDidMount",value:function(){this.subscribeSpinner(),this.subscribeSearch(),this.subscribeMobileSearch()}},{key:"componentWillUnmount",value:function(){this.$searchBox.off("shown.bs.collapse")}},{key:"renderSearchBox",value:function(){var e=this;return i.a.createElement("div",{className:"navbar-form navbar-right search-bar collapse in-sm",ref:function(t){return e.$searchBox=b()(t)}},i.a.createElement("input",{type:"text",className:"string optional form-control search-input",placeholder:"Search",onChange:this.props.handleSearchEnter,ref:function(t){return e.$searchInput=b()(t)}}),i.a.createElement("button",{type:"button",className:"close clear-search",onClick:this.handleSearchCleared.bind(this)},"\xd7"))}},{key:"renderMobileHamburgerMenu",value:function(){return i.a.createElement("button",{className:"navbar-toggle navbar-hamburger-button",type:"button",onClick:this.handleHamburgerButtonClick},i.a.createElement("span",{className:"icon-bar"}),i.a.createElement("span",{className:"icon-bar"}),i.a.createElement("span",{className:"icon-bar"}))}},{key:"renderMobileSearchButton",value:function(){var e=this;return i.a.createElement("button",{className:"navbar-toggle navbar-search-button",type:"button",onClick:this.handleSearchButtonClick.bind(this),ref:function(t){return e.$searchButton=b()(t)}},i.a.createElement("i",{className:"material-icons"},"search"))}},{key:"getSpinnerCssClass",value:function(){var e="spinner";return this.state.showSpinner||(e+=" hidden"),e}},{key:"getLogoCssClass",value:function(){var e="navbar-logo";return this.state.showSpinner&&(e+=" hidden"),e}},{key:"handleSearchButtonClick",value:function(){Q.isMobileMode()&&(this.$searchButton.hasClass("is-expanded")?(this.$searchButton.removeClass("is-expanded"),F.publish("search.hide")):(this.$searchButton.addClass("is-expanded"),F.publish("search.show")))}},{key:"handleHamburgerButtonClick",value:function(e){if(Q.isMobileMode()){var t=b()(e.target);t.hasClass("is-expanded")?(t.removeClass("is-expanded"),F.publish("hamburger.hide")):(t.addClass("is-expanded"),F.publish("hamburger.show"))}}},{key:"handleSearchCleared",value:function(e){this.$searchInput.val(""),b()(e.target).blur(),this.props.handleSearchCleared()}},{key:"subscribeSpinner",value:function(){var e=this;F.subscribe("spinner.toggle",function(t){e.setState({showSpinner:t.show})})}},{key:"subscribeSearch",value:function(){var e=this;F.subscribe("search.focus",function(){e.$searchInput.focus(),e.$searchInput.select()})}},{key:"subscribeMobileSearch",value:function(){var e=this;Q.isMobileMode()&&(F.subscribe("search.hide",function(){e.$searchButton.removeClass("is-expanded")}),this.$searchBox.collapse({toggle:!1}),this.$searchBox.on("hidden.bs.collapse",function(){F.publish("search.hide_end")}),F.subscribe("search.show",function(){e.$searchBox.collapse("show")}),F.subscribe("search.hide",function(){e.$searchBox.collapse("hide")}),F.subscribe("note.open",function(){""===e.$searchInput.val()&&F.publish("search.hide")}),this.$searchBox.on("shown.bs.collapse",function(){e.$searchInput.focus()}))}}]),t}(a.Component),ie=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={isSynced:e.isSynced},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({isSynced:e.isSynced})}},{key:"render",value:function(){return i.a.createElement("div",{className:"save-state"},this.state.isSynced?i.a.createElement("div",{className:"label label-success"},"Saved"):i.a.createElement("div",{className:"label label-warning"},"Saving"))}}]),t}(a.Component),re=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("button",{className:"btn btn-info btn-fab btn-new-note",onClick:this.handleNewNoteClick.bind(this)},i.a.createElement("i",{className:"material-icons"},"add"))}},{key:"handleNewNoteClick",value:function(e){e.preventDefault(),Q.isMobileMode()&&F.publish("hamburger.hide"),this.props.handleNewNoteClick()}}]),t}(a.Component),se=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"set",value:function(t){localStorage.setItem(e._getKey(t),t.toJson())}},{key:"get",value:function(t){return localStorage.getItem(e._getKey(t))}},{key:"eachNote",value:function(t){var n=e._getLocalStorageKeys(),a=!0,i=!1,r=void 0;try{for(var s,o=n[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var c=s.value,l=localStorage.getItem(c);t(JSON.parse(l),l)}}catch(u){i=!0,r=u}finally{try{a||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"remove",value:function(t){localStorage.removeItem(e._getKey(t))}},{key:"isEmpty",value:function(){return 0===e._getLocalStorageKeys().length}},{key:"_getLocalStorageKeys",value:function(){for(var t=[],n=localStorage.length,a=0;a<n;++a){var i=localStorage.key(a);i.startsWith(e.KEY_PREFIX)&&t.push(i)}return t}},{key:"_getKey",value:function(t){return e.KEY_PREFIX+t.uid}},{key:"KEY_PREFIX",get:function(){return"note-"}}]),e}(),oe=function(){function e(t){Object(o.a)(this,e),this.onServerSyncCallback=t,this.setSyncStatus()}return Object(c.a)(e,[{key:"startPolling",value:function(){setInterval(this.syncToServer.bind(this),e.POLLING_INTERVAL)}},{key:"setChange",value:function(e){this.setSyncStatus(!1),se.set(e)}},{key:"syncToServer",value:function(){var e=this;b.a.active||se.eachNote(function(t,n){var a="/api/notes/"+t.uid;b.a.ajax({url:a,method:"PUT",dataType:"json",data:{note:t}}).done(function(a){return e.ajaxDone(t,n,K.fromAttributes(a))}).fail(function(t,n,i){return e.ajaxFail(t,n,i,a)})})}},{key:"setSyncStatus",value:function(e,t){void 0===e&&(e=se.isEmpty()),window.onbeforeunload=e?void 0:function(){return"Behold! You have unsynchronized changes. If you leave the page now, your changes won't be saved to the server.\n(Your data won't be lost, but it will only remain locally in your browser)"},this.onServerSyncCallback({isSynced:e,note:t})}},{key:"ajaxDone",value:function(e,t,n){var a=se.get(e);if(t===a)se.remove(e);else{var i=K.fromAttributes(JSON.parse(a));i.serverUpdatedAt=n.serverUpdatedAt,se.set(i)}this.setSyncStatus(void 0,n)}},{key:"ajaxFail",value:function(e,t,n,a){0!==e.readyState&&(401===e.status?k.show('Your session has expired. You need to <a href="/" class="alert-link">sign in</a> again.<br>Your changes won\'t be lost, once you\'re signed in they will be saved to the server.'):422===e.status?k.show(e.responseJSON.errors.join("<br>")):(k.show("Something went sideways: "+n.toString()),console.error("url: ",a,"xhr: ",e,"status: ",t,"err: ",n.toString())))}}],[{key:"POLLING_INTERVAL",get:function(){return 3e3}}]),e}(),ce=function(e){function t(e,n){var a;Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).pushState=new ee(a.props.history);var i=a.props.match;return e.note?a.initStateFromNote(e.note):i.params.id?a.initStateFromNoteId(i.params.id):a.state=a.getNewNoteAttributes(),a.handleSearchEnterDebounced=B()(500,a.handleSearchEnterDebounced),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,this.renderHeaderBar(),this.renderContent())}},{key:"componentDidMount",value:function(){var e=this;this.autoSave=new oe(this.handleServerSync.bind(this)),this.autoSave.startPolling(),F.subscribe("note.create",function(t){e.setNewNote(function(){F.publish("hamburger.hide"),F.publish("note.update",t)})}),F.subscribe("note.new",function(t){e.setNewNote()})}},{key:"renderHeaderBar",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"navbar navbar-fixed-top navbar-info navbar-notes"},i.a.createElement(ae,{handleSearchEnter:this.handleSearchEnter.bind(this),handleSearchCleared:this.handleSearchCleared.bind(this)}),i.a.createElement(ie,{isSynced:this.state.isSynced}))))}},{key:"renderContent",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4"},i.a.createElement(J,{activeNoteUid:this.state.note.uid,isSynced:this.state.isSynced,isInitialEdit:this.state.isInitialEdit,searchQuery:this.state.searchQuery,handleNoteClick:this.handleNoteClick.bind(this),handleDeleteNoteClick:this.handleDeleteNoteClick.bind(this),handleArchiveNoteClick:this.handleArchiveNoteClick.bind(this)})),i.a.createElement("div",{className:"col-md-8"},i.a.createElement(Z,{note:this.state.note,handleChange:this.handleEditChange.bind(this)})),i.a.createElement(re,{handleNewNoteClick:this.handleNewNoteClick.bind(this)}))}},{key:"initStateFromNote",value:function(e){this.state={isInitialEdit:!0,note:K.fromAttributes(e)},this.pushState.setBrowserTitle(e)}},{key:"initStateFromNoteId",value:function(e){var t=this;this.state=Object(M.a)({},this.getNewNoteAttributes(),{isInitialEdit:!0}),b.a.ajax({url:"/api/notes/".concat(e),dataType:"json"}).done(function(e){var n=K.fromAttributes(e.note);t.setState({isInitialEdit:!0,note:n},function(){return t.pushState.setBrowserTitle(n)})}).fail(function(e,t,n){k.show("While trying to load the note the internet broke down (or something else failed, maybe the note could not be found)")})}},{key:"handleNoteClick",value:function(e,t){t.preventDefault(),this.setState({note:e}),this.pushState.setEdit(e),this.pushState.setBrowserTitle(e)}},{key:"handleDeleteNoteClick",value:function(e,t){var n=this;t.preventDefault(),t.stopPropagation(),$.a.confirm("Are you sure? <br> The note will be permanently deleted.",function(t){t&&(n.setState({isSynced:!1}),n.deleteNote(e))})}},{key:"handleArchiveNoteClick",value:function(e,t){var n=this;t.preventDefault(),t.stopPropagation(),$.a.confirm("Are you sure you want to archive this note?",function(t){t&&(e.setArchived(),n.handleEditChange(e),n.setNewNote())})}},{key:"handleNewNoteClick",value:function(){this.setNewNote()}},{key:"handleEditChange",value:function(e){this.pushState.setEdit(e),this.autoSave.setChange(e)}},{key:"handleServerSync",value:function(e){var t={isSynced:e.isSynced};e.note&&this.state.note.uid===e.note.uid&&(t.note=this.state.note,t.note.serverUpdatedAt=e.note.serverUpdatedAt),this.setState(t),e.isSynced&&this.pushState.setBrowserTitle(this.state.note)}},{key:"handleSearchEnter",value:function(e){e.persist(),this.handleSearchEnterDebounced(e)}},{key:"handleSearchEnterDebounced",value:function(e){this.setState({searchQuery:e.target.value}),F.publish("search.entered")}},{key:"handleSearchCleared",value:function(){this.setState({searchQuery:""}),F.publish("search.entered")}},{key:"getNewNoteAttributes",value:function(){return{note:new K}}},{key:"setNewNote",value:function(e){this.setState(this.getNewNoteAttributes(),e),this.pushState.setNew(),this.pushState.setBrowserTitle()}},{key:"deleteNote",value:function(e){var t=this;b.a.ajax({url:"/api/notes/"+e.uid,method:"DELETE",dataType:"json"}).done(function(){localStorage.removeItem("note-"+e.uid),t.state.note.uid===e.uid&&t.setNewNote()}).fail(function(t,n,a){var i="Oh my, the note could not be deleted.";0===t.readyState&&(i+="<br>Please check your internet connection (Well yes, sorry, deleting in offline mode is not yet suppported)."),k.show(i),console.error("note.uid: ",e.uid,"status: ",n,"error: ",a.toString())}).always(function(){t.setState({isSynced:!0})})}}]),t}(a.Component),le=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(A,{intro:this.renderIntro()},i.a.createElement("form",{onSubmit:this.handleFormSubmit.bind(this)},i.a.createElement(j,null),i.a.createElement("div",{className:"form-inputs"},this.renderTextInput("email","email","Email"),this.renderTextInput("password","password","Password"),this.renderTextInput("password","password_confirmation","Confirm password")),i.a.createElement("div",{className:"form-actions"},i.a.createElement(C,{label:"Register"}))))}},{key:"renderIntro",value:function(){return i.a.createElement("div",null,i.a.createElement("p",null,"You can register for a ",i.a.createElement("strong",null,"free account")," which ",i.a.createElement("strong",null,"limits")," you to ",i.a.createElement("strong",null,"100 notes"),".",i.a.createElement("br",null),"This free hosting service is sponsored by ",i.a.createElement("a",{href:"https://www.panter.ch"},"Panter AG"),"."),i.a.createElement("p",null,"Alternatively you may ",i.a.createElement("a",{href:"https://github.com/panter/mykonote"},"get the source code from GitHub")," and install it on a server on your own."))}},{key:"renderTextInput",value:function(e,t,n){return i.a.createElement(S,{type:e,model:"user",attribute:t,label:n,onChange:this.setValue.bind(this)})}},{key:"setValue",value:function(e,t){this.setState(Object(w.a)({},e,t))}},{key:"handleFormSubmit",value:function(e){var t=this;e.preventDefault(),b.a.ajax({url:"/users",method:"POST",dataType:"json",data:this.state}).done(function(e){k.clear(),y.show("Great! Glad you made it!<br>You have been subscribed to the <strong>free plan</strong> which <strong>limits</strong> you to have <strong>100 notes</strong>."),t.props.onLoginSuccess(),t.props.history.push("/notes")}).fail(function(e){var t=e.responseJSON.errors.join("<br>");k.show("Sorry, that did not work. You need to fix your inputs:<br>"+t)}).always(L)}}]),t}(a.Component),ue=(n(55),n(57),n(59),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isLoggedIn:null},n.setIsLoggedIn(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(d.a,null,i.a.createElement("div",{className:"container-fluid"},i.a.createElement(E,null),this.renderLoggedIn(),this.renderLoggedOut()))}},{key:"componentDidMount",value:function(){b.a.material.init()}},{key:"onLoginSuccess",value:function(){this.setState({isLoggedIn:!0})}},{key:"setIsLoggedIn",value:function(){var e=this;b.a.ajax({url:"/users/is_authenticated",method:"GET",dataType:"json"}).done(function(t,n,a){e.onLoginSuccess()}).fail(function(){e.setState({isLoggedIn:!1})})}},{key:"renderLoggedIn",value:function(){if(!0===this.state.isLoggedIn)return i.a.createElement(m.a,null,i.a.createElement(f.a,{path:"/notes/:id",component:ce}),i.a.createElement(f.a,{path:"/notes",component:ce}),i.a.createElement(v.a,{from:"/",to:"/notes"}))}},{key:"renderLoggedOut",value:function(){var e=this;if(!1===this.state.isLoggedIn)return i.a.createElement(m.a,null,i.a.createElement(f.a,{path:"/register",render:function(t){return i.a.createElement(le,Object.assign({onLoginSuccess:e.onLoginSuccess.bind(e)},t))}}),i.a.createElement(f.a,{path:"/login",render:function(t){return i.a.createElement(T,{onLoginSuccess:e.onLoginSuccess.bind(e)})}}),i.a.createElement(v.a,{to:"/login"}))}}]),t}(a.Component)),he=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function de(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}window.EventHive=F,window.NoticeFlash=y,window.AlertFlash=k,window.API_HOST&&b.a.ajaxPrefilter(function(e){e.url=window.API_HOST+e.url}),s.a.render(i.a.createElement(ue,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat(".","/service-worker.js");he?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):de(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):de(e)})}}()}},[[26,2,1]]]);
//# sourceMappingURL=main.bc435299.chunk.js.map