(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{103:function(e,t,n){},11:function(e,t,n){"use strict";var a=n(3),i=n(4),r=n(7),s=n(6),o=n(8),c=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getName",value:function(){return"alert"}},{key:"getAdditionalCssClass",value:function(){return"alert-warning"}}]),t}(n(16).a);t.a=c},114:function(e,t,n){},116:function(e,t,n){},118:function(e,t,n){},120:function(e,t,n){},127:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(22),s=n.n(r),o=n(3),c=n(4),l=n(7),u=n(6),h=n(8),d=n(137),g=n(139),f=n(138),m=n(136),v=n(5),p=n.n(v);window.jQuery=p.a,window.$=p.a;n(97),n(98),n(99),n(100),n(101);var b=n(15),y=n(11),k=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(b.a,null),i.a.createElement(y.a,null))}}]),t}(a.Component),S=n(23),w=n(24),E=n.n(w),N=n(19),L=n.n(N),C=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"subscribe",value:function(e,t){var n=this;this.topics.hasOwnProperty.call(this.topics,e)||(this.topics[e]=[]);var a=this.topics[e].push(t)-1;return{remove:function(){delete n.topics[e][a]}}}},{key:"publish",value:function(e,t){this.topics.hasOwnProperty.call(this.topics,e)&&this.topics[e].forEach(function(e){e(void 0!==t?t:{})})}},{key:"topics",get:function(){return"undefined"===typeof this._topics&&(this._topics={}),this._topics}}]),e}();L.a.prototype.stopCallback=function(){return!1},L.a.bind("alt+shift+f",function(){return C.publish("search.focus"),!1}),L.a.bind("alt+shift+n",function(){return C.publish("note.new"),!1});var j=n(25),x=n.n(j),O=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getMode",value:function(){var e=["xs","sm","md","lg"],t=window.document,n=t.createElement("div");t.body.appendChild(n);for(var a=e.length-1;a>=0;a--){var i=e[a];if(n.className="hidden-"+i,null===n.offsetParent)return t.body.removeChild(n),i}return""}},{key:"isMobileMode",value:function(){var e=this.getMode();return"xs"===e||"sm"===e}}]),e}(),A=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"generateV4",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}]),e}(),I=function(){function e(t,n,a,i,r,s){Object(o.a)(this,e),this._uid=t||A.generateV4(),this._title=n||"",this._content=a||"",this._createdAt=i||new Date,this._updatedAt=r||this._createdAt,this._serverUpdatedAt=this._updatedAt,this._archivedAt=s}return Object(c.a)(e,[{key:"setArchived",value:function(){this._archivedAt=new Date}},{key:"isNew",value:function(){return!this.title&&!this.content}},{key:"toJson",value:function(){return JSON.stringify({uid:this.uid,title:this.title,content:this.content,created_at:this.createdAt.toISOString(),updated_at:this.updatedAt.toISOString(),server_updated_at:this.serverUpdatedAt.toISOString(),archived_at:this.archivedAt?this.archivedAt.toISOString():null})}},{key:"uid",get:function(){return this._uid}},{key:"title",get:function(){return this._title},set:function(e){this._updatedAt=new Date,this._title=e}},{key:"content",get:function(){return this._content},set:function(e){this._updatedAt=new Date,this._content=e}},{key:"createdAt",get:function(){return this._createdAt}},{key:"updatedAt",get:function(){return this._updatedAt}},{key:"serverUpdatedAt",get:function(){return this._serverUpdatedAt},set:function(e){this._serverUpdatedAt=e}},{key:"archivedAt",get:function(){return this._archivedAt}}],[{key:"fromAttributes",value:function(t){return new e(t.uid,t.title,t.content,new Date(t.created_at),new Date(t.updated_at),t.archived_at?new Date(t.archived_at):null)}}]),e}();var _=function(){return i.a.createElement("svg",{className:"spinner",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("circle",{className:"path",fill:"none",strokeWidth:"6",strokeLinecap:"round",cx:"33",cy:"33",r:"30"}))},M=(n(103),function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={notes:[],currentPage:1,hasMorePages:!1,isSynced:!1,searchQuery:void 0},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:this.getListCssClass(),ref:function(t){return e.$list=p()(t)}},this.renderList(),this.renderNextPageLink(),this.renderListSpinner())}},{key:"renderList",value:function(){var e=this;return this.state.notes.map(function(t){return e.renderListItem(t)})}},{key:"renderListItem",value:function(e){return i.a.createElement("div",{key:e.uid},i.a.createElement("div",{className:this.getListItemCssClass(e),onClick:this.handleNoteClick.bind(this,e)},i.a.createElement("div",{className:"row-picture"},this.getNoteAvatar(e)),i.a.createElement("div",{className:"row-content"},this.renderListItemButton("action-secondary action-secondary-before",this.props.handleArchiveNoteClick.bind(this,e),"archive"),this.renderListItemButton("action-secondary",this.props.handleDeleteNoteClick.bind(this,e),"delete"),i.a.createElement("h4",{className:"list-group-item-heading"},e.title),i.a.createElement("div",{className:"list-group-item-text"},x.a.relativeTime(e.updatedAt)))),i.a.createElement("div",{className:"list-group-separator"}))}},{key:"renderListItemButton",value:function(e,t,n){return i.a.createElement("div",{className:e,onClick:t},i.a.createElement("i",{className:"material-icons"},n))}},{key:"renderNextPageLink",value:function(){if(this.state.hasMorePages)return i.a.createElement("div",{className:"list-more list-more-next-page"},i.a.createElement("button",{onClick:this.handleNextPageClick.bind(this),className:"btn btn-info btn-link btn-sm"},i.a.createElement("i",{className:"material-icons list-more-icon"},"expand_more")))}},{key:"renderListSpinner",value:function(){return i.a.createElement("div",{className:"list-more list-more-spinner hidden"},i.a.createElement(_,null))}},{key:"getListItemCssClass",value:function(e){var t="list-group-item note-navigation-item";return e.uid===this.props.activeNoteUid&&(t+=" active"),t}},{key:"getListCssClass",value:function(){var e="list-group notes-list collapse in-sm";return this.props.isInitialEdit||(e+=" in"),e}},{key:"componentDidMount",value:function(){var e=this;this.toggleListMore(!1),O.isMobileMode()&&(this.$list.collapse({toggle:!1}),this.$list.on("hidden.bs.collapse",function(){C.publish("hamburger.hide_end")}),C.subscribe("hamburger.show",function(){e.$list.collapse("show")}),C.subscribe("hamburger.hide",function(){e.$list.collapse("hide")}),C.subscribe("search.entered",function(){e.$list.collapse("show")}),C.subscribe("note.open",function(){e.$list.collapse("hide")}))}},{key:"componentDidUpdate",value:function(){this.listNeedsUpdate&&(this.listNeedsUpdate=!1,this.updateList())}},{key:"componentWillReceiveProps",value:function(e){!this.state.isSynced&&e.isSynced&&(this.listNeedsUpdate=!0),this.state.searchQuery!==e.searchQuery&&(this.listNeedsUpdate=!0),this.setState({isSynced:e.isSynced,searchQuery:e.searchQuery})}},{key:"handleNoteClick",value:function(e,t){p()(".note-navigation-item").removeClass("active"),p()(t.currentTarget).addClass("active"),O.isMobileMode()&&C.publish("hamburger.hide"),C.publish("note.open"),this.props.handleNoteClick(e,t)}},{key:"handleNextPageClick",value:function(e){var t=this;e.preventDefault(),p()(e.currentTarget).blur(),this.toggleListMore(!1),this.setState({currentPage:this.state.currentPage+1},function(){t.updateList()})}},{key:"updateList",value:function(){this.updateListRequest&&this.updateListRequest.abort(),this.updateListRequest=p.a.ajax({url:"/api/notes",dataType:"json",data:{search:this.state.searchQuery,page:this.state.currentPage}}),this.executeUpdateListRequest()}},{key:"executeUpdateListRequest",value:function(){var e=this;this.updateListRequest.done(function(t){e.toggleListMore(!0);var n=t.notes.map(function(e){return I.fromAttributes(e)});e.setState({notes:n,currentPage:t.current_page,hasMorePages:t.has_more_pages})}).fail(function(t,n,a){"abort"!==a&&(e.toggleListMore(!0),y.a.show("Watch out, the list is not up to date."),console.error("url: ",e.props.url,"status: ",n,"error: ",a.toString()))})}},{key:"getPreviewImageUrl",value:function(e){var t=e.content.match(/<img.*? src=['"]([^'"]+)['"].*?>/);return t?t[1]:null}},{key:"getNoteAvatar",value:function(e){var t=this.getPreviewImageUrl(e);if(t){var n={backgroundImage:"url(".concat(t,")"),backgroundRepeat:"no-repeat",backgroundSize:"cover"};return i.a.createElement("i",{style:n,className:"circle",alt:"note thumbnail"})}return i.a.createElement("i",{className:"material-icons"},"subject")}},{key:"toggleListMore",value:function(e){e?(p()(".list-more-next-page").removeClass("hidden"),p()(".list-more-spinner").addClass("hidden")):(p()(".list-more-next-page").addClass("hidden"),p()(".list-more-spinner").removeClass("hidden"))}}]),t}(a.Component)),T=n(1),B=n.n(T),P=n(26),D=n.n(P),$=n(27),U=n.n($),R=n(28),F=n.n(R),W=n(29),H=n.n(W),Q=n(30),q=n.n(Q),K=n(31),Y=n.n(K),J=n(32),z=n.n(J),V=n(33),G=n.n(V),X=n(34),Z=n.n(X),ee=n(35),te=n.n(ee),ne=n(36),ae=n.n(ne),ie=n(37),re=n.n(ie),se=n(38),oe=n.n(se),ce=n(39),le=n.n(ce),ue=n(40),he=n.n(ue),de=n(41),ge=n.n(de),fe=n(42),me=n.n(fe),ve=n(43),pe=n.n(ve),be=n(44),ye=n.n(be),ke=n(45),Se=n.n(ke),we=n(46),Ee=n.n(we),Ne=n(47),Le=n.n(Ne),Ce=n(48),je=n.n(Ce),xe=n(49),Oe=n.n(xe),Ae=n(50),Ie=n.n(Ae),_e=n(51),Me=n.n(_e),Te=n(52),Be=n.n(Te),Pe=n(53),De=n.n(Pe),$e=n(54),Ue=n.n($e),Re=n(55),Fe=n.n(Re),We=n(56),He=n.n(We),Qe=n(57),qe=n.n(Qe),Ke=n(58),Ye=n.n(Ke),Je=n(59),ze=n.n(Je),Ve=n(60),Ge=n.n(Ve),Xe=n(61),Ze=n.n(Xe),et=n(62),tt=n.n(et),nt=n(63),at=n.n(nt),it=n(64),rt=n.n(it),st=n(65),ot=n.n(st),ct=n(66),lt=n.n(ct),ut=n(67),ht=n.n(ut),dt=n(68),gt=n.n(dt),ft=n(69),mt=n.n(ft),vt=n(70),pt=n.n(vt),bt=n(71),yt=n.n(bt),kt=n(72),St=n.n(kt),wt=n(73),Et=n.n(wt),Nt=n(74),Lt=n.n(Nt),Ct=n(75),jt=n.n(Ct),xt=n(76),Ot=n.n(xt),At=n(77),It=n.n(At),_t=n(78),Mt=n.n(_t),Tt=n(79),Bt=n.n(Tt),Pt=n(80),Dt=n.n(Pt),$t=n(81),Ut=n.n($t),Rt=n(82),Ft=n.n(Rt),Wt=n(83),Ht=n.n(Wt),Qt=n(84),qt=n.n(Qt),Kt=n(85),Yt=n.n(Kt),Jt=n(86),zt=n.n(Jt),Vt=n(87),Gt=n.n(Vt),Xt=n(88),Zt=n.n(Xt),en=n(89),tn=n.n(en),nn=n(90),an=n.n(nn);n(105);B.a.registerLanguage("asciidoc",D.a),B.a.registerLanguage("bash",U.a),B.a.registerLanguage("basic",F.a),B.a.registerLanguage("clean",H.a),B.a.registerLanguage("clojure",q.a),B.a.registerLanguage("cmake",Y.a),B.a.registerLanguage("coffeescript",z.a),B.a.registerLanguage("cpp",G.a),B.a.registerLanguage("crystal",Z.a),B.a.registerLanguage("cs",te.a),B.a.registerLanguage("css",ae.a),B.a.registerLanguage("d",re.a),B.a.registerLanguage("dart",oe.a),B.a.registerLanguage("diff",le.a),B.a.registerLanguage("dockerfile",he.a),B.a.registerLanguage("ebnf",ge.a),B.a.registerLanguage("elixir",me.a),B.a.registerLanguage("elm",pe.a),B.a.registerLanguage("erb",ye.a),B.a.registerLanguage("erlang",Se.a),B.a.registerLanguage("fsharp",Ee.a),B.a.registerLanguage("gherkin",Le.a),B.a.registerLanguage("go",je.a),B.a.registerLanguage("gradle",Oe.a),B.a.registerLanguage("groovy",Ie.a),B.a.registerLanguage("haml",Me.a),B.a.registerLanguage("handlebars",Be.a),B.a.registerLanguage("htmlbars",De.a),B.a.registerLanguage("http",Ue.a),B.a.registerLanguage("ini",Fe.a),B.a.registerLanguage("java",He.a),B.a.registerLanguage("javascript",qe.a),B.a.registerLanguage("json",Ye.a),B.a.registerLanguage("kotlin",ze.a),B.a.registerLanguage("less",Ge.a),B.a.registerLanguage("lisp",Ze.a),B.a.registerLanguage("llvm",tt.a),B.a.registerLanguage("makefile",at.a),B.a.registerLanguage("markdown",rt.a),B.a.registerLanguage("mathematica",ot.a),B.a.registerLanguage("matlab",lt.a),B.a.registerLanguage("nginx",ht.a),B.a.registerLanguage("objectivec",gt.a),B.a.registerLanguage("perl",mt.a),B.a.registerLanguage("pgsql",pt.a),B.a.registerLanguage("php",yt.a),B.a.registerLanguage("plaintext",St.a),B.a.registerLanguage("powershell",Et.a),B.a.registerLanguage("prolog",Lt.a),B.a.registerLanguage("properties",jt.a),B.a.registerLanguage("python",Ot.a),B.a.registerLanguage("r",It.a),B.a.registerLanguage("ruby",Mt.a),B.a.registerLanguage("rust",Bt.a),B.a.registerLanguage("scala",Dt.a),B.a.registerLanguage("scss",Ut.a),B.a.registerLanguage("shell",Ft.a),B.a.registerLanguage("sql",Ht.a),B.a.registerLanguage("stylus",qt.a),B.a.registerLanguage("swift",Yt.a),B.a.registerLanguage("tex",zt.a),B.a.registerLanguage("typescript",Gt.a),B.a.registerLanguage("vim",Zt.a),B.a.registerLanguage("xml",tn.a),B.a.registerLanguage("yaml",an.a),window.hljs=B.a;var rn=n(13),sn=n.n(rn),on=(n(128),n(112),n(114),function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={note:a.props.note},a.shouldRerender=!0,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("form",{className:"form-horizontal",ref:function(t){return e.formContainerElement=t},onSubmit:this.handleFormSubmit},i.a.createElement("div",{className:"form-inputs"},this.renderTitle(),this.renderContent())))}},{key:"renderTitle",value:function(){var e=this;return i.a.createElement("div",{className:"form-group form-group-no-label string optional"},i.a.createElement("input",{type:"text",className:"string optional form-control",value:this.state.note.title,onChange:this.handleTitleChange.bind(this),placeholder:"Title",ref:function(t){return e.titleElement=t}}))}},{key:"renderContent",value:function(){var e=this;return i.a.createElement("div",{className:"form-group form-group-no-label text optional"},i.a.createElement("div",{ref:function(t){return e.contentContainerElement=t}}))}},{key:"handleFormSubmit",value:function(e){return e.preventDefault(),!1}},{key:"handleTitleChange",value:function(){this.shouldRerender=!0;var e=this.state.note;e.title=this.titleElement.value,this.setState({note:e},this.handleChange)}},{key:"handleContentChange",value:function(){this.shouldRerender=!1;var e=this.state.note;e.content=this.contentElement.innerHTML,this.setState({note:e},this.handleChange)}},{key:"handleChange",value:function(){this.props.handleChange(this.state.note)}},{key:"componentDidMount",value:function(){var e=this;this.focusTitleFieldIfNewNote(),this.renderEditor(),C.subscribe("note.update",function(t){e.titleElement.value=t.title,e.handleTitleChange(),e.editor.pasteHTML(t.content)}),O.isMobileMode()&&(C.subscribe("hamburger.show",function(){e.formContainerElement.classList.add("hidden")}),C.subscribe("hamburger.hide",function(){e.formContainerElement.classList.remove("hidden")}),C.subscribe("search.entered",function(){e.formContainerElement.classList.add("hidden")}))}},{key:"componentDidUpdate",value:function(){this.editor.off("text-change"),this.editor.setText(""),this.contentElement.innerHTML=this.state.note.content,this.editor.history.clear(),this.editor.update(),this.editor.on("text-change",this.handleContentChange.bind(this))}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.note.uid!==this.state.note.uid&&(this.shouldRerender=!0,this.setState({note:e.note},function(){return t.focusTitleFieldIfNewNote()}))}},{key:"shouldComponentUpdate",value:function(e,t){return this.shouldRerender}},{key:"renderEditor",value:function(){this.editor=new sn.a(this.contentContainerElement,{theme:"snow",modules:{syntax:!0,toolbar:[[{header:[1,2,!1]}],["bold","italic","strike"],[{color:[]},{background:[]}],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"},"task-list",{indent:"-1"},{indent:"+1"}],["link","image"],["clean"]],"task-list":!0}}),this.contentElement=this.contentContainerElement.querySelector(".ql-editor")}},{key:"focusTitleFieldIfNewNote",value:function(){this.state.note.isNew()&&this.titleElement.focus()}}]),t}(a.Component)),cn=function(){function e(t){Object(o.a)(this,e),this.history=t}return Object(c.a)(e,[{key:"setNew",value:function(){this.history.push("/notes")}},{key:"setEdit",value:function(e){var t="/notes/".concat(e.uid);this.history.location.pathname!==t&&this.history.push(t)}},{key:"setBrowserTitle",value:function(e){e&&e.title?document.title="".concat(e.title," | Mykonote"):document.title="Mykonote"}}]),e}(),ln=n(91),un=n.n(ln),hn=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={showSpinner:!1},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4"},i.a.createElement("div",{className:"navbar-header"},this.renderLogo(),this.renderMobileHamburgerMenu(),this.renderMobileSearchButton()),this.renderSearchBox()))}},{key:"renderLogo",value:function(){return i.a.createElement("div",{className:"navbar-brand"},i.a.createElement("div",{className:"navbar-spinner"},this.state.showSpinner?i.a.createElement(_,null):i.a.createElement("div",{className:"navbar-logo"},i.a.createElement("img",{src:un.a,alt:"logo"}))))}},{key:"componentDidMount",value:function(){this.subscribeSpinner(),this.subscribeSearch(),this.subscribeMobileSearch()}},{key:"componentWillUnmount",value:function(){this.$searchBox.off("shown.bs.collapse")}},{key:"renderSearchBox",value:function(){var e=this;return i.a.createElement("div",{className:"navbar-form navbar-right search-bar collapse in-sm",ref:function(t){return e.$searchBox=p()(t)}},i.a.createElement("input",{type:"text",className:"string optional form-control search-input",placeholder:"Search",onChange:this.props.handleSearchEnter,ref:function(t){return e.$searchInput=p()(t)}}),i.a.createElement("button",{type:"button",className:"close clear-search",onClick:this.handleSearchCleared.bind(this)},"\xd7"))}},{key:"renderMobileHamburgerMenu",value:function(){return i.a.createElement("button",{className:"navbar-toggle navbar-hamburger-button",type:"button",onClick:this.handleHamburgerButtonClick},i.a.createElement("span",{className:"icon-bar"}),i.a.createElement("span",{className:"icon-bar"}),i.a.createElement("span",{className:"icon-bar"}))}},{key:"renderMobileSearchButton",value:function(){var e=this;return i.a.createElement("button",{className:"navbar-toggle navbar-search-button",type:"button",onClick:this.handleSearchButtonClick.bind(this),ref:function(t){return e.$searchButton=p()(t)}},i.a.createElement("i",{className:"material-icons"},"search"))}},{key:"getSpinnerCssClass",value:function(){var e="spinner";return this.state.showSpinner||(e+=" hidden"),e}},{key:"getLogoCssClass",value:function(){var e="navbar-logo";return this.state.showSpinner&&(e+=" hidden"),e}},{key:"handleSearchButtonClick",value:function(){O.isMobileMode()&&(this.$searchButton.hasClass("is-expanded")?(this.$searchButton.removeClass("is-expanded"),C.publish("search.hide")):(this.$searchButton.addClass("is-expanded"),C.publish("search.show")))}},{key:"handleHamburgerButtonClick",value:function(e){if(O.isMobileMode()){var t=p()(e.target);t.hasClass("is-expanded")?(t.removeClass("is-expanded"),C.publish("hamburger.hide")):(t.addClass("is-expanded"),C.publish("hamburger.show"))}}},{key:"handleSearchCleared",value:function(e){this.$searchInput.val(""),p()(e.target).blur(),this.props.handleSearchCleared()}},{key:"subscribeSpinner",value:function(){var e=this;C.subscribe("spinner.toggle",function(t){e.setState({showSpinner:t.show})})}},{key:"subscribeSearch",value:function(){var e=this;C.subscribe("search.focus",function(){e.$searchInput.focus(),e.$searchInput.select()})}},{key:"subscribeMobileSearch",value:function(){var e=this;O.isMobileMode()&&(C.subscribe("search.hide",function(){e.$searchButton.removeClass("is-expanded")}),this.$searchBox.collapse({toggle:!1}),this.$searchBox.on("hidden.bs.collapse",function(){C.publish("search.hide_end")}),C.subscribe("search.show",function(){e.$searchBox.collapse("show")}),C.subscribe("search.hide",function(){e.$searchBox.collapse("hide")}),C.subscribe("note.open",function(){""===e.$searchInput.val()&&C.publish("search.hide")}),this.$searchBox.on("shown.bs.collapse",function(){e.$searchInput.focus()}))}}]),t}(a.Component),dn=function(e){function t(e,n){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).state={isSynced:e.isSynced},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({isSynced:e.isSynced})}},{key:"render",value:function(){return i.a.createElement("div",{className:"save-state"},this.state.isSynced?i.a.createElement("div",{className:"label label-success"},"Saved"):i.a.createElement("div",{className:"label label-warning"},"Saving"))}}]),t}(a.Component),gn=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("button",{className:"btn btn-info btn-fab btn-new-note",onClick:this.handleNewNoteClick.bind(this)},i.a.createElement("i",{className:"material-icons"},"add"))}},{key:"handleNewNoteClick",value:function(e){e.preventDefault(),O.isMobileMode()&&C.publish("hamburger.hide"),this.props.handleNewNoteClick()}}]),t}(a.Component),fn=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"set",value:function(t){localStorage.setItem(e._getKey(t),t.toJson())}},{key:"get",value:function(t){return localStorage.getItem(e._getKey(t))}},{key:"eachNote",value:function(t){var n=e._getLocalStorageKeys(),a=!0,i=!1,r=void 0;try{for(var s,o=n[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var c=s.value,l=localStorage.getItem(c);t(JSON.parse(l),l)}}catch(u){i=!0,r=u}finally{try{a||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"remove",value:function(t){localStorage.removeItem(e._getKey(t))}},{key:"isEmpty",value:function(){return 0===e._getLocalStorageKeys().length}},{key:"_getLocalStorageKeys",value:function(){for(var t=[],n=localStorage.length,a=0;a<n;++a){var i=localStorage.key(a);i.startsWith(e.KEY_PREFIX)&&t.push(i)}return t}},{key:"_getKey",value:function(t){return e.KEY_PREFIX+t.uid}},{key:"KEY_PREFIX",get:function(){return"note-"}}]),e}(),mn=function(){function e(t){Object(o.a)(this,e),this.onServerSyncCallback=t,this.setSyncStatus()}return Object(c.a)(e,[{key:"startPolling",value:function(){setInterval(this.syncToServer.bind(this),e.POLLING_INTERVAL)}},{key:"setChange",value:function(e){this.setSyncStatus(!1),fn.set(e)}},{key:"syncToServer",value:function(){var e=this;p.a.active||fn.eachNote(function(t,n){var a="/api/notes/"+t.uid;p.a.ajax({url:a,method:"PUT",dataType:"json",data:{note:t}}).done(function(a){return e.ajaxDone(t,n,I.fromAttributes(a))}).fail(function(t,n,i){return e.ajaxFail(t,n,i,a)})})}},{key:"setSyncStatus",value:function(e,t){void 0===e&&(e=fn.isEmpty()),window.onbeforeunload=e?void 0:function(){return"Behold! You have unsynchronized changes. If you leave the page now, your changes won't be saved to the server.\n(Your data won't be lost, but it will only remain locally in your browser)"},this.onServerSyncCallback({isSynced:e,note:t})}},{key:"ajaxDone",value:function(e,t,n){var a=fn.get(e);if(t===a)fn.remove(e);else{var i=I.fromAttributes(JSON.parse(a));i.serverUpdatedAt=n.serverUpdatedAt,fn.set(i)}this.setSyncStatus(void 0,n)}},{key:"ajaxFail",value:function(e,t,n,a){0!==e.readyState&&(401===e.status?y.a.show('Your session has expired. You need to <a href="/" class="alert-link">sign in</a> again.<br>Your changes won\'t be lost, once you\'re signed in they will be saved to the server.'):422===e.status?y.a.show(e.responseJSON.errors.join("<br>")):(y.a.show("Something went sideways: "+n.toString()),console.error("url: ",a,"xhr: ",e,"status: ",t,"err: ",n.toString())))}}],[{key:"POLLING_INTERVAL",get:function(){return 3e3}}]),e}(),vn=function(e){function t(e,n){var a;Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e,n))).pushState=new cn(a.props.history);var i=a.props.match;return e.note?a.initStateFromNote(e.note):i.params.id?a.initStateFromNoteId(i.params.id):a.state=a.getNewNoteAttributes(),a.handleSearchEnterDebounced=E()(500,a.handleSearchEnterDebounced),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,this.renderHeaderBar(),this.renderContent())}},{key:"componentDidMount",value:function(){var e=this;this.autoSave=new mn(this.handleServerSync.bind(this)),this.autoSave.startPolling(),C.subscribe("note.create",function(t){e.setNewNote(function(){C.publish("hamburger.hide"),C.publish("note.update",t)})}),C.subscribe("note.new",function(t){e.setNewNote()})}},{key:"renderHeaderBar",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"navbar navbar-fixed-top navbar-info navbar-notes"},i.a.createElement(hn,{handleSearchEnter:this.handleSearchEnter.bind(this),handleSearchCleared:this.handleSearchCleared.bind(this)}),i.a.createElement(dn,{isSynced:this.state.isSynced}))))}},{key:"renderContent",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-4"},i.a.createElement(M,{activeNoteUid:this.state.note.uid,isSynced:this.state.isSynced,isInitialEdit:this.state.isInitialEdit,searchQuery:this.state.searchQuery,handleNoteClick:this.handleNoteClick.bind(this),handleDeleteNoteClick:this.handleDeleteNoteClick.bind(this),handleArchiveNoteClick:this.handleArchiveNoteClick.bind(this)})),i.a.createElement("div",{className:"col-md-8"},i.a.createElement(on,{note:this.state.note,handleChange:this.handleEditChange.bind(this)})),i.a.createElement(gn,{handleNewNoteClick:this.handleNewNoteClick.bind(this)}))}},{key:"initStateFromNote",value:function(e){this.state={isInitialEdit:!0,note:I.fromAttributes(e)},this.pushState.setBrowserTitle(e)}},{key:"initStateFromNoteId",value:function(e){var t=this;this.state=Object(S.a)({},this.getNewNoteAttributes(),{isInitialEdit:!0}),p.a.ajax({url:"/api/notes/".concat(e),dataType:"json"}).done(function(e){var n=I.fromAttributes(e.note);t.setState({isInitialEdit:!0,note:n},function(){return t.pushState.setBrowserTitle(n)})}).fail(function(e,t,n){y.a.show("While trying to load the note the internet broke down (or something else failed, maybe the note could not be found)")})}},{key:"handleNoteClick",value:function(e,t){t.preventDefault(),this.setState({note:e}),this.pushState.setEdit(e),this.pushState.setBrowserTitle(e)}},{key:"handleDeleteNoteClick",value:function(e,t){var a=this;t.preventDefault(),t.stopPropagation(),n.e(0).then(n.t.bind(null,135,7)).then(function(t){t.confirm("Are you sure? <br> The note will be permanently deleted.",function(t){t&&(a.setState({isSynced:!1}),a.deleteNote(e))})})}},{key:"handleArchiveNoteClick",value:function(e,t){var a=this;t.preventDefault(),t.stopPropagation(),n.e(0).then(n.t.bind(null,135,7)).then(function(t){t.confirm("Are you sure you want to archive this note?",function(t){t&&(e.setArchived(),a.handleEditChange(e),a.setNewNote())})})}},{key:"handleNewNoteClick",value:function(){this.setNewNote()}},{key:"handleEditChange",value:function(e){this.pushState.setEdit(e),this.autoSave.setChange(e)}},{key:"handleServerSync",value:function(e){var t={isSynced:e.isSynced};e.note&&this.state.note.uid===e.note.uid&&(t.note=this.state.note,t.note.serverUpdatedAt=e.note.serverUpdatedAt),this.setState(t),e.isSynced&&this.pushState.setBrowserTitle(this.state.note)}},{key:"handleSearchEnter",value:function(e){e.persist(),this.handleSearchEnterDebounced(e)}},{key:"handleSearchEnterDebounced",value:function(e){this.setState({searchQuery:e.target.value}),C.publish("search.entered")}},{key:"handleSearchCleared",value:function(){this.setState({searchQuery:""}),C.publish("search.entered")}},{key:"getNewNoteAttributes",value:function(){return{note:new I}}},{key:"setNewNote",value:function(e){this.setState(this.getNewNoteAttributes(),e),this.pushState.setNew(),this.pushState.setBrowserTitle()}},{key:"deleteNote",value:function(e){var t=this;p.a.ajax({url:"/api/notes/"+e.uid,method:"DELETE",dataType:"json"}).done(function(){localStorage.removeItem("note-"+e.uid),t.state.note.uid===e.uid&&t.setNewNote()}).fail(function(t,n,a){var i="Oh my, the note could not be deleted.";0===t.readyState&&(i+="<br>Please check your internet connection (Well yes, sorry, deleting in offline mode is not yet suppported)."),y.a.show(i),console.error("note.uid: ",e.uid,"status: ",n,"error: ",a.toString())}).always(function(){t.setState({isSynced:!0})})}}]),t}(a.Component),pn=(n(116),n(118),n(120),i.a.lazy(function(){return n.e(2).then(n.bind(null,133))})),bn=i.a.lazy(function(){return n.e(3).then(n.bind(null,134))}),yn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isLoggedIn:null},n.setIsLoggedIn(),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(d.a,null,i.a.createElement("div",{className:"container-fluid"},i.a.createElement(k,null),this.renderLoggedIn(),this.renderLoggedOut()))}},{key:"componentDidMount",value:function(){p.a.material.init()}},{key:"onLoginSuccess",value:function(){this.setState({isLoggedIn:!0})}},{key:"setIsLoggedIn",value:function(){var e=this;p.a.ajax({url:"/users/is_authenticated",method:"GET",dataType:"json"}).done(function(t,n,a){e.onLoginSuccess()}).fail(function(){e.setState({isLoggedIn:!1})})}},{key:"renderLoggedIn",value:function(){if(!0===this.state.isLoggedIn)return i.a.createElement(g.a,null,i.a.createElement(f.a,{path:"/notes/:id",component:vn}),i.a.createElement(f.a,{path:"/notes",component:vn}),i.a.createElement(m.a,{from:"/",to:"/notes"}))}},{key:"renderLoggedOut",value:function(){var e=this;if(!1===this.state.isLoggedIn)return i.a.createElement(g.a,null,i.a.createElement(f.a,{path:"/register",render:function(t){return i.a.createElement(a.Suspense,{fallback:i.a.createElement("div",null)},i.a.createElement(bn,Object.assign({onLoginSuccess:e.onLoginSuccess.bind(e)},t)))}}),i.a.createElement(f.a,{path:"/login",render:function(t){return i.a.createElement(a.Suspense,{fallback:i.a.createElement("div",null)},i.a.createElement(pn,{onLoginSuccess:e.onLoginSuccess.bind(e),alwaysRememberMe:window.ALWAYS_REMEMBER_ME}))}}),i.a.createElement(m.a,{to:"/login"}))}}]),t}(a.Component),kn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Sn(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}window.EventHive=C,window.NoticeFlash=b.a,window.AlertFlash=y.a,window.API_HOST&&p.a.ajaxPrefilter(function(e){e.url=window.API_HOST+e.url}),s.a.render(i.a.createElement(yn,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat(".","/service-worker.js");kn?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Sn(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Sn(e)})}}(),function(){var e=void 0;p()(document).ajaxStart(function(){clearTimeout(e),e=setTimeout(function(){C.publish("spinner.toggle",{show:!0})},500)}),p()(document).ajaxStop(function(){clearTimeout(e),C.publish("spinner.toggle",{show:!1})})}()},15:function(e,t,n){"use strict";var a=n(3),i=n(4),r=n(7),s=n(6),o=n(8),c=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getName",value:function(){return"notice"}},{key:"getAdditionalCssClass",value:function(){return"alert-info"}}]),t}(n(16).a);t.a=c},16:function(e,t,n){"use strict";var a=n(3),i=n(4),r=n(7),s=n(6),o=n(8),c=n(0),l=n.n(c),u=n(5),h=n.n(u),d=function(e){function t(e,n){var i;return Object(a.a)(this,t),(i=Object(r.a)(this,Object(s.a)(t).call(this,e,n))).state={message:e.message},i}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return this.state.message?l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-md-4 col-md-offset-4"},l.a.createElement("div",{className:this.getCssClass()},l.a.createElement("button",{className:"close",type:"button",onClick:this.handleClose.bind(this)},"\xd7"),l.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.message}})))):null}},{key:"getCssClass",value:function(){return["alert","alert-dismissible",this.getAdditionalCssClass()].join(" ")}},{key:"handleClose",value:function(){this.setState({message:null})}},{key:"componentDidMount",value:function(){var e=this;h()(document).on(this.constructor.getEventName(),function(t,n){e.setState({message:n.message})})}},{key:"componentWillUnmount",value:function(){h()(document).off(this.constructor.getEventName())}},{key:"getAdditionalCssClass",value:function(){}},{key:"getName",value:function(){}}],[{key:"getEventName",value:function(){return"mykonote.flash."+this.prototype.getName()}},{key:"show",value:function(e){h()(document).trigger(this.getEventName(),{message:e})}},{key:"clear",value:function(){h()(document).trigger(this.getEventName(),{message:null})}}]),t}(c.Component);t.a=d},91:function(e,t,n){e.exports=n.p+"static/media/logo.8ad1a424.svg"},92:function(e,t,n){e.exports=n(127)}},[[92,5,4]]]);
//# sourceMappingURL=main.46f36b95.chunk.js.map